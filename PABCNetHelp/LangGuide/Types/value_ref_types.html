<html>

<head>
<object type="application/x-oleobject" classid="clsid:1e2a7bd0-dab9-11d0-b93a-00c04fc99f9e">
<param name="Keyword" value="Размерные типы">
<param name="Keyword" value="Ссылочные типы">
</object>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<title></title>
<link rel="StyleSheet" href="../../default.css">
</head>

<body>
<H1>Размерные и ссылочные типы</H1>
<p>Все типы в <strong>PascalABC.NET</strong> подразделяются на две большие группы: <i><b>размерные</b></i> и 
<i><b>ссылочные</b></i>. К размерным относятся все простые типы, указатели, 
записи, статические массивы, множества, файлы, размерные строки. К ссылочным типам относятся 
классы, динамические массивы, строки, кортежи и процедурный тип. </p>
<p>Размерные типы более эффективны при вычислениях: они занимают меньше памяти и 
операции, выполняемые над небольшими размерными типами, максимально эффективны. 
Ссылочные типы обладают большей гибкостью: память под них выделяется динамически 
в процессе работы программы и освобождается автоматически, когда объект 
ссылочного типа перестаёт использоваться.</p>
<h2>Выделение памяти</h2>
<p>Память под переменную размерного типа распределяется на программном стеке в момент 
её описания. При этом переменная размерного типа хранит значение этого 
типа.</p>
<blockquote>
	<p><code><strong>var</strong> i: integer; // здесь под i выделяется память<br>
	i := 5; </code></p>
</blockquote>
<p>Переменная ссылочного типа представляет собой ссылку на объект некоторого 
класса в динамической памяти. Если она не инициализирована, то хранит 
специальное значение nil (нулевая ссылка). Для инициализации ссылочных 
переменных используется вызов конструктора соответствующего класса:</p>
<blockquote>
	<p><code><strong>type</strong> Person = <strong>auto class<br> </strong>&nbsp; 
	name: string;<br>&nbsp; age: integer;<br><strong>end;</strong></code></p>
	<p><code><strong>var </strong>p: Person; // p хранит значение nil, память 
	под объект не выделена<br>p := new Person('Иванов',20); // конструктор 
	выделяет память под объект </code>&nbsp; </p>
</blockquote>
<h2>Особенности PascalABC.NET</h2>
<p>Статические массивы, размерные строки и множества в PascalABC.NET эмулируются 
динамическими структурами, поэтому на стеке располагается лишь некоторый 
дескриптор. </p>
<p>Строки инициализируются по умолчанию не значением nil, а пустой строкой. </p>
<h2>Присваивание</h2>
<p>При присваивании переменных размерного типа копируются значения этого типа. 
Если размерный тип имеет большой размер, эта операция может выполняться долго. 
Например:</p>
<blockquote>
	<p><code><strong>var </strong>a,a1: <strong>array</strong> [1..1000000]
	<strong>of</strong> integer; <br>a1 := a; // копируются все 1000000 
	элементов</code></p>
</blockquote>
<p>При присваивании переменных ссылочного типа осуществляется присваивание 
ссылок, в итоге после присваивания обе ссылки ссылаются на один объект в 
динамической памяти:</p>
<blockquote>
	<p><code><strong>var </strong>p1: Person; <br>p1 := p; // копируется ссылка</code></p>
</blockquote>
<h2>Сравнение на равенство</h2>
<p>Сравнение на равенство объектов размерного типа сравнивает их значения. В 
частности, две переменные типа запись равны если равны все поля этих записей.</p>
<blockquote>
	<p><code><strong>type </strong>PersonRec = <strong>record</strong><br>&nbsp; 
	name: string;<br>&nbsp; age: integer;<br><strong>end;<br>var </strong>p,p1: 
	PersonRec;<br>p.name := 'Иванов'; p.age := 20;<br>p1.name := 'Иванов'; 
	p1.age := 20;<br>writeln(p1=p); // True</code></p>
</blockquote>
<p>При сравнении на равенство переменных ссылочного типа по умолчанию проверяется, что они 
ссылаются на один и тот же объект.</p>
<blockquote>
	<p><code><strong>var </strong>p := new Person('Иванов',20); <br><strong>var
	</strong>p1 := new Person('Иванов',20); <br>writeln(p1=p); // False</code>&nbsp;</p>
</blockquote>
<p>Исключение составляют ссылочные объекты с переопределённым действием операции 
сравнения.</p>
<h2>Управление памятью</h2>
<p>Размерные типы распределяются на программном стеке, поэтому не нуждаются в 
специальном управлении памятью. Под глобальные размерные переменные память 
распределена всё время работы программы. Под локальные размерные переменные 
память выделяется в момент вызова подпрограммы. а освобождается в момент 
завершения работы этой подпрограммы.</p>
<p><a href="../MemoryManagement/index_memory.html">Управление памятью для ссылочных типов</a> осуществляется автоматически 
сборщиком мусора. Сборщик мусора запускается в неопределенный момент времени 
когда управляемой памяти перестаёт хватать. Он возвращает в пул неиспользуемой 
памяти те объекты, на которые больше никто не ссылается, после чего 
дефрагментирует оставшуюся память, в результате чего динамическая память всегда 
дефрагментирована и ее выделение при вызове конструктора происходит практически 
мгновенно.</p>
<h2>&nbsp;Передача в подпрограммы</h2>
<p>При передаче размерных типов по значению происходит копирование значения 
фактического параметра в переменную-формальный параметр. Если размерный тип 
имеет большой размер, это может занимать продолжительное время, поэтому 
размерный тип в этом случае передаётся по ссылке на константу:</p>
<blockquote>
	<p><code><strong>type</strong> Arr = <strong>array</strong> [1..100] <strong>
	of</strong> integer;<br><br><strong>procedure</strong> 
	PrintArray(<strong>const</strong> a: Arr; n: integer);<br><strong>begin</strong><br>&nbsp;
	<strong>for</strong> <strong>var</strong> i:=1 <strong>to</strong> 
	n <strong>do</strong><br>&nbsp;&nbsp;&nbsp; Print(a[i])<br><strong>end</strong>;</code></p>
</blockquote>
<p>Ссылочные типы передаются в подпрограмму, как правило, по значению. При 
передаче таких параметров происходит копирование ссылки, в результате формальный 
и фактический параметр будут ссылаться на один объект.</p>
<blockquote>
	<p><code><strong>procedure</strong> 
	Change666(a: <strong>array of</strong> integer);<br><strong>begin</strong><br>&nbsp;
	a[0] := 666;<br><strong>end</strong>;</code></p>
</blockquote>
<p>При этом в результате изменения формального параметра внутри подпрограммы 
меняется и содержимое соответствующего фактического параметра при вызове 
подпрограммы.</p>
</body>

</html>